[workspace]
name = "G4.1-ArenaController"
version = "6.0.0"
description = "Arduino library for communicating with the Reiser Lab Modular LED panels display arena."
authors = ["Peter Polidoro <peter@polidoro.io>"]
channels = ["conda-forge"]
platforms = ["linux-64", "osx-64", "osx-arm64", "win-64"]

[tasks]
ports = "pio device list"
check-version = "python tools/version_sync.py check"

# Default example: examples/ArenaControllerTeensy12-12
[tasks.build]
cmd = "pio run -e teensy41"
env = { PLATFORMIO_SRC_DIR = "$PIXI_PROJECT_ROOT/examples/ArenaControllerTeensy12-12" }

[tasks.build-mongoose]
cmd = "pio run -e teensy41"
env = { PLATFORMIO_SRC_DIR = "$PIXI_PROJECT_ROOT/examples/MongooseTest" }

[tasks.build-sdcard]
cmd = "pio run -e teensy41"
env = { PLATFORMIO_SRC_DIR = "$PIXI_PROJECT_ROOT/examples/SDCardDebugTest" }

[tasks.build-watchdog]
cmd = "pio run -e teensy41"
env = { PLATFORMIO_SRC_DIR = "$PIXI_PROJECT_ROOT/examples/WatchdogTest" }

[tasks.upload]
args = [{ arg = "port", default = "/dev/ttyACM0" }]
cmd = "pio run -e teensy41 -t upload --upload-port {{ port }}"
env = { PLATFORMIO_SRC_DIR = "$PIXI_PROJECT_ROOT/examples/ArenaControllerTeensy12-12" }

[tasks.upload-mongoose]
args = [{ arg = "port", default = "/dev/ttyACM0" }]
cmd = "pio run -e teensy41 -t upload --upload-port {{ port }}"
env = { PLATFORMIO_SRC_DIR = "$PIXI_PROJECT_ROOT/examples/MongooseTest" }

[tasks.upload-sdcard]
args = [{ arg = "port", default = "/dev/ttyACM0" }]
cmd = "pio run -e teensy41 -t upload --upload-port {{ port }}"
env = { PLATFORMIO_SRC_DIR = "$PIXI_PROJECT_ROOT/examples/SDCardDebugTest" }

[tasks.upload-watchdog]
args = [{ arg = "port", default = "/dev/ttyACM0" }]
cmd = "pio run -e teensy41 -t upload --upload-port {{ port }}"
env = { PLATFORMIO_SRC_DIR = "$PIXI_PROJECT_ROOT/examples/WatchdogTest" }

[tasks.set-version]
args = ["new_version"]
cmd = "python tools/version_sync.py set {{ new_version }}"

# Quantum Leaps host tools (QM and QTools/QSPY) pinned for qp-arduino compatibility
[tasks.ql-install]
cmd = "python tools/quantum_leaps_tools.py install"

[tasks.qm]
cmd = "python tools/quantum_leaps_tools.py qm"

[tasks.qm-install]
cmd = "python tools/quantum_leaps_tools.py qm --install-only"

[tasks.qtools-install]
cmd = "python tools/quantum_leaps_tools.py qtools-install"

# Run QSPY (extra CLI args are forwarded to qspy, e.g. `pixi run qspy -c /dev/ttyACM0 -b 115200`)
[tasks.qspy]
cmd = "python tools/quantum_leaps_tools.py qspy"


[dependencies]
platformio = ">=6.1.16,<7"

[target.linux-64.dependencies]
make = "*"
c-compiler = "*"

[target.osx-64.dependencies]
make = "*"
c-compiler = "*"

[target.osx-arm64.dependencies]
make = "*"
c-compiler = "*"

